System.register(["react","react-dom","@ofa/utils","rxjs","rxjs/operators","rxjs/ajax"],(function(e){"use strict";var t,r,n,o,a,i,s,c,p,u,l,d,m,f,h,v,b,y,g,O,j;return{setters:[function(e){t=e.useState,r=e.useEffect,n=e.useMemo,o=e.default},function(e){a=e.default},function(e){i=e.logger},function(e){s=e.combineLatest,c=e.skip,p=e.map,u=e.BehaviorSubject,l=e.of,d=e.Subject},function(e){m=e.map,f=e.filter,h=e.switchMap,v=e.share,b=e.catchError,y=e.withLatestFrom,g=e.concatWith,O=e.skip},function(e){j=e.ajax}],execute:function(){function E({props:e,stateHub:n}){const o={},a={},i={};Object.entries(e).forEach((([e,{initialValue:t,template:r,stateID:s}])=>{o[e]=t,a[e]=r,i[e]=n.getState(s)}));const[u,l]=t(o);return r((()=>{const e=s(i).pipe(c(1),p((e=>function(e,t){return Object.entries(e).map((([e,r])=>{var n;return[e,t[e]?null==(n=t[e])?void 0:n.call(t,r):r]})).reduce(((e,[t,r])=>(e[t]=r,e)),{})}(e,a)))).subscribe(l);return()=>e.unsubscribe()}),[]),u}function w({nodeProps:e,stateHub:r}){const{apiDerivedProps:o,apiInvokeProps:a,constantProps:s}=function(e){const t={},r={},n={};return Object.entries(e).forEach((([e,o])=>{if(Array.isArray(o))r[e]=o;else{if("constant_property"!==o.type)return"api_invoke_property"===o.type?(r[e]||(r[e]=[]),void r[e].push(o)):void("api_derived_property"!==o.type||(t[e]=o));n[e]=o.value}})),{apiDerivedProps:t,apiInvokeProps:r,constantProps:n}}(e),[c]=t((()=>function(e,t){return Object.entries(e).reduce(((e,[r,n])=>(e[r]=function(...e){n.forEach((({stateID:r,paramsBuilder:n,onError:o,onSuccess:a})=>{const s=t.getAction(r);try{s({params:null==n?void 0:n(...e),onError:o,onSuccess:a})}catch(e){i.log("failed to run convertor or run action:",e)}}))},e)),{})}(a,r))),p=E({props:o,stateHub:r});return n((()=>Object.assign(s,c,p)),[p])}function S({nodes:e,stateHub:t}){return e.length?o.createElement(o.Fragment,null,e.map((e=>o.createElement(P,{key:e.key,node:e,stateHub:t})))):null}function P({node:e,stateHub:t}){const[r,n]=o.useState(!1),a=o.useRef(),s=w({nodeProps:e.props||{},stateHub:t});return o.useEffect((()=>{if("html-element"===e.type)return a.current=e.name,void n(!0);var t,r;(t=e.packageName,r=e.exportName,e.packageVersion,System.import(t).then((e=>e[r||"default"]))).then((t=>{t||i.error(`got empty component for package: ${e.packageName},`,`exportName: ${e.exportName}, version: ${e.packageVersion}`),a.current=t,n(!0)}))}),[]),r&&a.current?e.children&&e.children.length?o.createElement(a.current,s,o.createElement(S,{nodes:e.children||[],stateHub:t})):o.createElement(a.current,s):null}e("default",(function({schema:e,rootEle:t,apiDoc:r}){const n=function({node:e,statesMap:t}){try{return{statesMap:t,node:C(e)}}catch(e){return console.error(e),null}}(e);if(!n)return;const i=new ce(r,n.statesMap);window.stateHub=i,function({schema:e,rootEle:t,stateHub:r}){a.render(o.createElement(P,{node:e.node,stateHub:r}),t)}({schema:n,stateHub:i,rootEle:t})}));var _,$,D=Object.defineProperty,I=Object.defineProperties,q=Object.getOwnPropertyDescriptors,k=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable,M=(e,t,r)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,T=(e,t)=>{for(var r in t||(t={}))H.call(t,r)&&M(e,r,t[r]);if(k)for(var r of k(t))x.call(t,r)&&M(e,r,t[r]);return e},A=(e,t)=>I(e,q(t));function B({type:e,args:t,body:r}){return"api_state_mapper_func_spec"===e?new Function("apiState",r):"param_builder_func_spec"===e?new Function(t,r):"api_invoke_call_func_spec"===e?new Function("apiState",r):void 0}function C(e){const t=(e.children||[]).map((e=>C(e)));return A(T({},e),{children:t,props:(r=e.props||{},Object.entries(r).map((([e,t])=>Array.isArray(t)?[e,t.map((({type:e,stateID:t,paramsBuilder:r,onSuccess:n,onError:o})=>({type:e,stateID:t,paramsBuilder:r?B(r):void 0,onSuccess:n?B(n):void 0,onError:o?B(o):void 0})))]:"constant_property"===t.type?[e,t]:"api_derived_property"===t.type?[e,A(T({},t),{template:t.template?B(t.template):void 0})]:"api_invoke_property"===t.type?[e,A(T({},t),{paramsBuilder:t.paramsBuilder?B(t.paramsBuilder):void 0,onSuccess:t.onSuccess?B(t.onSuccess):void 0,onError:t.onError?B(t.onError):void 0})]:null)).filter((e=>!!e)).reduce(((e,[t,r])=>(e[t]=r,e)),{}))});var r}($=_||(_={})).GET="get",$.PUT="put",$.POST="post",$.DELETE="delete",$.OPTIONS="options",$.HEAD="head",$.PATCH="patch",$.TRACE="trace";const N=Object.values(_);class F{constructor(e){this.operationMap=function(e){const t={};for(const[r,n]of Object.entries(e.paths))if(n)for(const e of N){const o=n[e];o&&(t[`${o.operationId}`]={path:r,method:e,parameters:o.parameters,requestBody:o.requestBody})}return t}(e),this.docComponents=e.components}buildRequest(e,t){const r=this.operationMap[e];if(!r)throw new Error(`can not find spec for operation: ${e}`);const{path:n,method:o,parameters:a}=r,i={method:o,path:n};return null==a||a.forEach((r=>{var n,o,a,s,c,p,u,l;if(!("$ref"in r)){if("path"===r.in){if(r.required&&void 0===(null==(n=null==t?void 0:t.params)?void 0:n[r.name]))throw new Error(`parameter '${r.name}' required in path for ${e}`);i.path=i.path.replace(`{${r.name}}`,null==(o=null==t?void 0:t.params)?void 0:o[r.name])}if("query"===r.in){if(r.required&&void 0===(null==(a=null==t?void 0:t.params)?void 0:a[r.name]))throw new Error(`parameter '${r.name}' required in query for ${e}`);void 0!==(null==(s=null==t?void 0:t.params)?void 0:s[r.name])&&(i.query=i.query||{},i.query[r.name]=null==(c=null==t?void 0:t.params)?void 0:c[r.name])}if("header"===r.in){if(r.required&&void 0===(null==(p=null==t?void 0:t.params)?void 0:p[r.name]))throw new Error(`parameter '${r.name}' required in header for ${e}`);void 0!==(null==(u=null==t?void 0:t.params)?void 0:u[r.name])&&(i.header=i.header||{},i.header[r.name]=null==(l=null==t?void 0:t.params)?void 0:l[r.name])}}})),i.body=null==t?void 0:t.body,i}}var V=Object.defineProperty,R=Object.defineProperties,L=Object.getOwnPropertyDescriptors,G=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable,z=(e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,J=(e,t)=>{for(var r in t||(t={}))U.call(t,r)&&z(e,r,t[r]);if(G)for(var r of G(t))W.call(t,r)&&z(e,r,t[r]);return e},K=(e,t)=>R(e,L(t));const Q=()=>{};function X(e){let t=`http://localhost:8080${e.path}`;const r=Object.entries(e.query||{}).map((([e,t])=>`${e}=${t}`)).join("&");return r&&(t=`${t}?${r}`),{method:e.method,url:t,headers:{"Content-Type":"application/json"},async:!0,timeout:1e3,crossDomain:!1,withCredentials:!1,responseType:"json",body:e.body}}function Y(e){return j(e).pipe(m((({response:e})=>({data:e,error:void 0}))),b((e=>l({error:e,data:void 0}))))}const Z={data:void 0,error:void 0,loading:!1};function ee(e){const t=new u(Z),r=function(e){const t=e.pipe(m(X),h(Y),v());return t.subscribe(Q),t}(e);return r.pipe(m((e=>K(J({},e),{loading:!1})))).subscribe(t),e.pipe(f((()=>!1===t.getValue().loading)),m((()=>K(J({},t.getValue()),{loading:!0})))).subscribe(t),t}var te=Object.defineProperty,re=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,se=(e,t,r)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;class ce{constructor(e,t){this.statesCache={},this.specInterpreter=new F(e),this.stateIDMap=t}getState(e){const[t]=this.getStream(e);return t}getAction(e){const[,{run:t}]=this.getStream(e);return t}getStream(e){this.stateIDMap[e];const t=`${e}:${this.stateIDMap[e]}`;return this.statesCache[t]||(this.statesCache[t]=this.initState(e)),this.statesCache[t]}refresh(e){const[,{refresh:t}]=this.getStream(e);t()}initState(e){const t=new d,r=ee(t.pipe(m((t=>{var r;return this.specInterpreter.buildRequest(null==(r=this.stateIDMap[e])?void 0:r.operationID,t)})))).pipe(y(l(void 0).pipe(g(t))),m((([e,t])=>{return r=((e,t)=>{for(var r in t||(t={}))ae.call(t,r)&&se(e,r,t[r]);if(oe)for(var r of oe(t))ie.call(t,r)&&se(e,r,t[r]);return e})({},e),re(r,ne({params:t}));var r})));let n;r.pipe(O(1)).subscribe((e=>{setTimeout((()=>{!function(e,t){var r,n;e.loading||(e.error?null==(r=null==t?void 0:t.onError)||r.call(t,e):null==(n=null==t?void 0:t.onSuccess)||n.call(t,e))}(e,n)}),10)}));return[r,{run:e=>{n=e,t.next(null==e?void 0:e.params)},refresh:()=>{n={params:null==n?void 0:n.params},t.next(null==n?void 0:n.params)}}]}}}}}));
